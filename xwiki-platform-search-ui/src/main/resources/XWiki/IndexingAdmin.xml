<?xml version="1.0" encoding="UTF-8"?>
<xwikidoc>
<web>XWiki</web>
<name>IndexingAdmin</name>
<language></language>
<defaultLanguage></defaultLanguage>
<translation>0</translation>
<parent>Main.WebHome</parent>
<creator>xwiki:XWiki.Admin</creator>
<author>xwiki:XWiki.Admin</author>
<customClass></customClass>
<contentAuthor>xwiki:XWiki.Admin</contentAuthor>
<creationDate>1344201193000</creationDate>
<date>1344725123000</date>
<contentUpdateDate>1344725123000</contentUpdateDate>
<version>1.1</version>
<title>IndexingAdmin</title>
<template></template>
<defaultTemplate></defaultTemplate>
<validationScript></validationScript>
<comment></comment>
<minorEdit>false</minorEdit>
<syntaxId>xwiki/2.1</syntaxId>
<hidden>false</hidden>
<object>
<class>
<name>XWiki.ConfigurableClass</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<codeToExecute>
<disabled>0</disabled>
<editor>---</editor>
<name>codeToExecute</name>
<number>7</number>
<picker>0</picker>
<prettyName>codeToExecute</prettyName>
<rows>5</rows>
<size>40</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</codeToExecute>
<configurationClass>
<disabled>0</disabled>
<name>configurationClass</name>
<number>3</number>
<picker>0</picker>
<prettyName>configurationClass</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</configurationClass>
<configureGlobally>
<defaultValue></defaultValue>
<disabled>0</disabled>
<displayFormType>checkbox</displayFormType>
<displayType></displayType>
<name>configureGlobally</name>
<number>4</number>
<prettyName>configureGlobally</prettyName>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</configureGlobally>
<displayInSection>
<disabled>0</disabled>
<name>displayInSection</name>
<number>1</number>
<picker>0</picker>
<prettyName>displayInSection</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</displayInSection>
<heading>
<disabled>0</disabled>
<name>heading</name>
<number>2</number>
<picker>0</picker>
<prettyName>heading</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</heading>
<iconAttachment>
<disabled>0</disabled>
<name>iconAttachment</name>
<number>8</number>
<picker>0</picker>
<prettyName>iconAttachment</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</iconAttachment>
<linkPrefix>
<disabled>0</disabled>
<name>linkPrefix</name>
<number>5</number>
<picker>0</picker>
<prettyName>linkPrefix</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</linkPrefix>
<propertiesToShow>
<cache>0</cache>
<disabled>0</disabled>
<displayType>input</displayType>
<multiSelect>1</multiSelect>
<name>propertiesToShow</name>
<number>6</number>
<picker>0</picker>
<prettyName>propertiesToShow</prettyName>
<relationalStorage>1</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>20</size>
<sort>none</sort>
<unmodifiable>0</unmodifiable>
<validationMessage></validationMessage>
<validationRegExp></validationRegExp>
<values></values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</propertiesToShow>
</class>
<name>Xwiki.IndexingAdmin</name>
<number>0</number>
<className>XWiki.ConfigurableClass</className>
<guid>1c5d86e1-bdfa-4e70-afcc-711e00cd2403</guid>
<property>
<codeToExecute>{{include document="XWiki.IndexingAdmin"/}}</codeToExecute>
</property>
<property>
<configurationClass></configurationClass>
</property>
<property>
<configureGlobally>1</configureGlobally>
</property>
<property>
<displayInSection>Indexing</displayInSection>
</property>
<property>
<heading>Indexing</heading>
</property>
<property>
<iconAttachment></iconAttachment>
</property>
<property>
<linkPrefix></linkPrefix>
</property>
<property>
<propertiesToShow/>
</property>
</object>
<object>
<class>
<name>XWiki.StyleSheetExtension</name>
<customClass></customClass>
<customMapping></customMapping>
<defaultViewSheet></defaultViewSheet>
<defaultEditSheet></defaultEditSheet>
<defaultWeb></defaultWeb>
<nameField></nameField>
<validationScript></validationScript>
<cache>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>cache</name>
<number>5</number>
<prettyName>Caching policy</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>long|short|default|forbid</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</cache>
<code>
<disabled>0</disabled>
<name>code</name>
<number>2</number>
<prettyName>Code</prettyName>
<rows>20</rows>
<size>50</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.TextAreaClass</classType>
</code>
<name>
<disabled>0</disabled>
<name>name</name>
<number>1</number>
<prettyName>Name</prettyName>
<size>30</size>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.StringClass</classType>
</name>
<parse>
<disabled>0</disabled>
<displayFormType>select</displayFormType>
<displayType>yesno</displayType>
<name>parse</name>
<number>4</number>
<prettyName>Parse content</prettyName>
<unmodifiable>0</unmodifiable>
<classType>com.xpn.xwiki.objects.classes.BooleanClass</classType>
</parse>
<use>
<cache>0</cache>
<disabled>0</disabled>
<displayType>select</displayType>
<multiSelect>0</multiSelect>
<name>use</name>
<number>3</number>
<prettyName>Use this extension</prettyName>
<relationalStorage>0</relationalStorage>
<separator> </separator>
<separators> ,|</separators>
<size>1</size>
<unmodifiable>0</unmodifiable>
<values>currentPage=Always on this page|onDemand=On demand|always=Always on this wiki</values>
<classType>com.xpn.xwiki.objects.classes.StaticListClass</classType>
</use>
</class>
<name>Search.IndexingAdmin</name>
<number>0</number>
<className>XWiki.StyleSheetExtension</className>
<guid>6cf73107-da6f-4a1c-9d85-007d7512aa4b</guid>
<property>
<cache>long</cache>
</property>
<property>
<code></code>
</property>
<property>
<name>Indexing StyleSheet</name>
</property>
<property>
<parse></parse>
</property>
<property>
<use>currentPage</use>
</property>
</object>
<content>{{velocity}}
{{html wiki="true"}}

#set($docextras = [])
$xwiki.jsx.use("XWiki.SearchAdminMacros")
$xwiki.ssx.use("Main.SearchMacros")

&lt;div style="padding:10px;&gt;Index the wiki by clicking the button&lt;/div&gt;
&lt;div id="indexing_request"&gt;

#set($indexoption="$!request.getParameter('indexselect')")

#macro(spaceoption $space $selectedSpace)
  &lt;option value="${space}" #if($selectedSpace == $space)selected="selected"#end&gt;$space&lt;/option&gt;
#end
#macro(spaceselect $selectedSpace $spaces)
  &lt;select name="space" title="$msg.get('search.page.bar.spaces.title')"&gt;
    #foreach($space in $spaces)
      #if (!$blacklistedSpaces.contains($space) &amp;&amp; $xwiki.hasAccessLevel('view', "${space}.DocumentReservedForInternalXWikiUsage${mathtool.random(0, 999)}"))
        #spaceoption($space $selectedSpace)
      #end
    #end
  &lt;/select&gt;
#end

#set($spaces = $xwiki.spaces)
#set($selectedSpace = "$!request.space")
#if($selectedSpace != '' &amp;&amp; !$blacklistedSpaces.contains($selectedSpace))
  #set($extraClause = " AND space:${selectedSpace}")
#end

#set($searchindex=$services.search.getSearchIndex())

#if($indexoption == "indexwiki")
    ### Call Index Wiki.
    #set($buildindex=$searchindex.getBuildIndexInstance())
    #set($totaldocs=$buildindex.buildWikiIndex($doc.getDocumentReference().getWikiReference()))

#elseif($indexoption=="indexspace")
   ### Call Index Space.
   #if($selectedSpace != "")
       #set($buildindex=$searchindex.getBuildIndexInstance())
       #set($spaceref= $xwiki.getDocument("${selectedSpace}.WebHome").getDocumentReference().getLastSpaceReference())
       #set($totaldocs=$buildindex.buildWikiSpaceIndex($spaceref))
   #end
#elseif($indexoption=="deletewiki")
   ### Call Index Space.
   #set($deleteindex=$searchindex.getDeleteIndexInstance())
   #set($totaldocs=$deleteindex.deleteWikiIndex($doc.getDocumentReference().getWikiReference()))
#elseif($indexoption=="deletespace")
   #if($selectedSpace != "")
       #set($deleteindex=$searchindex.getDeleteIndexInstance())
       #set($spaceref= $xwiki.getDocument("${selectedSpace}.WebHome").getDocumentReference().getLastSpaceReference())
       #set($totaldocs=$deleteindex.deleteSpaceIndex($spaceref))
   #end
#elseif($indexoption=="deleteindex")
   ### Call Index Space.
   #set($deleteindex=$searchindex.getDeleteIndexInstance())
   #set($totaldocs=$deleteindex.deleteEntireIndex())
#end


&lt;form method="post"&gt;
     &lt;div id="indexselectdiv"&gt;
     &lt;select name="indexselect" id="indexselect"&gt;
         &lt;option #if($indexoption=="indexspace") selected=true #end value="indexspace"&gt;Index Space&lt;/option&gt;
         &lt;option #if($indexoption=="indexwiki") selected=true #end value="indexwiki"&gt;Index Wiki&lt;/option&gt;
         &lt;option #if($indexoption=="deleteindex") selected=true #end value="deleteindex"&gt;Delete Entire Index&lt;/option&gt;
         &lt;option #if($indexoption=="deletewiki") selected=true #end value="deletewiki"&gt;Delete Wiki Index&lt;/option&gt;
         &lt;option #if($indexoption=="deletespace") selected=true #end value="deletespace"&gt;Delete Space Index&lt;/option&gt;
         &lt;option #if($indexoption=="rebuildwiki") selected=true #end value="rebuildwiki&gt;Rebuild Wiki Index&lt;/option&gt;
         &lt;option #if($indexoption=="rebuildspace") selected=true #end value="rebuildspace"&gt;Rebuild Space Index&lt;/option&gt;
     &lt;/select&gt;
     #if($indexoption == "indexspace" || $indexoption == "deletespace" || $indexoption == "rebuildspace" )
         Choose a Space:      
         #spaceselect($selectedSpace $spaces)
     #end
     &lt;input type="submit" class="button" id="startIndex" value="Start"/&gt; 
     &lt;/div&gt;
&lt;/form&gt;

&lt;/div&gt;
&lt;div id="indexing_response"&gt;
&lt;/div&gt;

{{/html}}
{{/velocity}}
</content></xwikidoc>